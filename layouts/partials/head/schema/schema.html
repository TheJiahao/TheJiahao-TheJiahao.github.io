{{ $schema := partialCached "head/schema/base" . .RelPermalink }}

{{- if .IsHome }}
    {{ $schema = partialCached "head/schema/home-page" . .RelPermalink }}
{{- else if eq .Params.Layout "about" }}
    {{ $schema = partial "head/schema/profile-page" . }}
{{- else if eq .Params.Layout "search" }}
    {{ $schema = partialCached "head/schema/search-page" . .RelPermalink }}
{{- else if .IsPage }}
    {{- $articleImage := partialCached "helper/image" (dict "Context" . "Type" "article") .RelPermalink "article" -}}
    {{- with $articleImage.permalink }}
        {{ $schema = merge $schema (dict "image" .) }}
    {{ end -}}
    {{ $schema = merge $schema (
        dict
        "@type" "BlogPosting"
        "wordCount" .WordCount
        "headline" .Title
        "mainEntityOfPage" (dict "@type" "WebPage" "@id" .Permalink)
        )
    }}

    {{ with .Date }}
        {{ $schema = merge $schema (dict "datePublished" (.Format "2006-01-02T15:04:05-07:00")) }}
    {{ end }}
{{- end }}

<script type="application/ld+json">
{{ $schema | jsonify (dict "indent" "    ") | safeJS }}
</script>
