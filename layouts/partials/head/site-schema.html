{{- $license := default .Site.Params.article.license.default .Params.License | markdownify -}}
{{- $title := default .Site.Title .Title -}}
{{- $description := partialCached "data/description" . .RelPermalink -}}
{{- $author := default .Site.Params.Author.Name .Params.Author -}}

{{- $avatar := .Site.Params.Sidebar.Avatar -}}
{{- $avatar := cond $avatar.local $avatar $avatar.src -}}

<script type="application/ld+json">
{
    "name": {{ $title }},
    "@context": "http://schema.org",
    "author": {
        "@type": "Person",
        "name": {{ $author }},
        "url": {{ absLangURL "about"}}
    },
    "copyrightHolder": {
        "@type": "Person",
        "name": {{ $author }}
    },
    "license": {{ $license }},
    "url": {{ .Permalink }},
    {{- with $description }}
    "description": {{ . }},
    {{ end -}}
    "dateModified": {{ .Lastmod.Format "2006-01-02T15:04:05-07:00" | safeHTML }},
{{- if or .IsHome (eq .Params.Layout "search") }}
    "potentialAction": {
        "@type": "SearchAction",
        "name": "Internal search",
        "target": {
            "@type": "EntryPoint",
            "urlTemplate": {{ absLangURL "search/?keyword={search_term_string}"}}
        },
        "query-input": "required name=search_term_string"
    },
{{ end -}}
{{- if .IsHome }}
    {{- with .Site.Params.image }}
    "image": {{ .url | absURL }},
    {{ end -}}
    "@type": "WebSite"
{{- else if eq .Params.Layout "about" }}
    "image": {{ $avatar }},
    "@type": "ProfilePage",
    "mainEntity": {
        "@type": "Person",
        "name": {{ $author }},
        "sameAs": [
        {{- range $k, $_ := .Site.Menus.social -}}
            {{ if $k }},{{ end }}
            {{ .URL | absURL -}}
        {{ end }}
        ]
    }
{{- else if eq .Params.Layout "search" }}
    "@type": "SearchResultsPage"
{{- else if .IsPage }}
    {{- $articleImage := partialCached "helper/image" (dict "Context" . "Type" "article") .RelPermalink "article" -}}
    {{- with $articleImage.permalink }}
    "image": {{ . }},
    {{ end -}}
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": {{ .Permalink }}
    },
    {{- with .Date }}
    "datePublished": {{ .Format "2006-01-02T15:04:05-07:00" | safeHTML }},
    {{ end -}}
    "headline": {{ $title }}
{{- end }}
}
</script>
