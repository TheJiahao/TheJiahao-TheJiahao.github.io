---
import type { MarkdownHeading } from "astro";
import BackButton from "components/atoms/BackButton";
import BlogFooter from "components/molecules/BlogFooter.astro";
import BlogHeader from "components/molecules/BlogHeader.astro";
import Article from "components/organisms/Article.astro";
import CommentList from "components/organisms/CommentList";
import LinkList from "components/molecules/LinkList";
import TableOfContents from "components/organisms/TableOfContents";
import { BLOG_IMAGE_PLACEHOLDER } from "config";
import BaseLayout from "layouts/BaseLayout.astro";
import ContentLayout from "layouts/ContentLayout.astro";
import type { BlogData } from "utils/getBlogs";
import { getTranslation } from "utils/getTranslation";

type Props = BlogData & {
    headings: MarkdownHeading[];
};

const {
    title,
    description,
    date,
    image = BLOG_IMAGE_PLACEHOLDER,
    links,
    license,
    language,
    lastModified,
    headings,
    math,
} = Astro.props;
---

<BaseLayout {title} {description} {image}>
    <Fragment slot="head">
        {
            math && (
                <>
                    <link
                        rel="stylesheet"
                        href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
                        integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+"
                        crossorigin="anonymous"
                    />
                    <script
                        src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js"
                        integrity="sha384-HORx6nWi8j5/mYA+y57/9/CZc5z8HnEw4WUZWy5yOn9ToKBv1l58vJaufFAn9Zzi"
                        crossorigin="anonymous"
                        is:inline
                    />
                </>
            )
        }
    </Fragment>

    <aside
        slot="left-sidebar"
        fixed
        top-0
        z-1
        p-lg
        lg="sticky h-screen justify-self-end"
    >
        <BackButton {language} />
    </aside>

    <ContentLayout>
        <Article>
            <BlogHeader slot="header" {title} {description} {date} {image} />
            <slot />
            <BlogFooter slot="footer" {lastModified} licenseText={license} />
        </Article>

        {
            links && (
                <LinkList
                    {links}
                    aria-label={getTranslation(language).externalLinks}
                    className="card"
                />
            )
        }

        <CommentList {language} client:idle />
    </ContentLayout>

    <aside un-hidden lg="block sticky top-0 p-lg h-screen">
        {headings.length > 0 && <TableOfContents {headings} client:load />}
    </aside>
</BaseLayout>
