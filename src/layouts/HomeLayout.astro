---
import { getRelativeLocaleUrl } from "astro:i18n";
import type { BlogCardProps } from "../components/BlogCard";
import BlogList from "../components/BlogList";
import HeadHrefLangs from "../components/HeadHrefLangs.astro";
import NavigationBar from "../components/NavigationBar";
import SiteFooter from "../components/SiteFooter";
import ToolBar from "../components/ToolBar";
import getBlogs from "../utils/getBlogs";
import { getTranslation } from "../utils/translation";
import BaseLayout from "./BaseLayout.astro";

interface Props {
    language: string;
}

const { language } = Astro.props;

const blogs: BlogCardProps[] = (await getBlogs())
    .filter((blog) => blog.language === language)
    .map((blog) => {
        const { data, language, slug } = blog;

        return {
            ...data,
            url: getRelativeLocaleUrl(language, `posts/${slug}`),
        };
    })
    .sort((a, b) => +b.date - +a.date);
---

<BaseLayout
    {language}
    title={getTranslation(language).siteTitle}
    description={getTranslation(language).siteDescription}
>
    <HeadHrefLangs slot="head" />
    <div flex="~ col" min-w-60ch gap-4 lg="flex-row">
        <div w-full p-4 lg="sticky top-0 h-screen max-w-25ch">
            <NavigationBar {language} />
        </div>
        <div w-full flex="~ col" gap-10 my-2>
            <ToolBar {language} client:load />
            <main>
                <BlogList {blogs} />
            </main>

            <SiteFooter {language} />
        </div>
    </div>
</BaseLayout>
