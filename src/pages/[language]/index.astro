---
import { getRelativeLocaleUrl } from "astro:i18n";
import type { ImageCardProps } from "components/molecules/ImageCard";
import { DEFAULT_LANGUAGE, SITE_DESCRIPTION, SITE_TITLE } from "config";
import { languageCodes } from "localization";
import getBlogs from "utils/getBlogs";
import HomeLayout from "../../layouts/HomeLayout.astro";
import { getLanguageAlternates } from "utils/getLanguageAlternates";

export function getStaticPaths() {
    return languageCodes.map((language) => ({
        params: { language },
    }));
}

const language = Astro.currentLocale ?? DEFAULT_LANGUAGE;
const languageAlternates = getLanguageAlternates(
    Astro.url.pathname,
    languageCodes,
);

const blogs: ImageCardProps[] = getBlogs()
    .filter(({ data }) => data.language === language)
    .map(({ data, slug }) => ({
        ...data,
        url: getRelativeLocaleUrl(language, `posts/${slug}`),
    }))
    .sort((a, b) => +b.date - +a.date);
---

<HomeLayout
    title={SITE_TITLE[language]}
    description={SITE_DESCRIPTION[language]}
    {blogs}
    {language}
    {languageAlternates}
/>
